import{C as e,E as t,T as n,_ as r,a as i,h as a,i as o,n as s,r as c,s as l,t as u,x as d,y as f}from"./index-DYWCQ-ZW.js";var p=[`src`,`height`],m={__name:`Gift`,props:{trigger:{type:Date,default:void 0},config:{type:Object,required:!0}},emits:[`finished`],setup(i,{emit:u}){let m=i,h=u,g=e(null),_=e(!1),v=e(0),y=e(0),b=e([]),x=c(()=>m.config.run3D?`three-dimension`:`flat`),S=c(()=>360/m.config.gifts.length),C=c(()=>m.config.height/2/Math.tan(S.value/2/180*Math.PI)),w=()=>{g.value&&(g.value.style.setProperty(`--rotateY`,`${m.config.rotateY}deg`),g.value.style.setProperty(`--duration`,`${m.config.duration}ms`),g.value.style.setProperty(`--fontSize`,`${m.config.fontSize}px`),g.value.style.setProperty(`--height`,`${m.config.height}px`),g.value.style.setProperty(`--width`,`${m.config.width}px`),g.value.style.setProperty(`--currentDeg`,`-${v.value}deg`))},T=()=>{m.config.gifts.forEach((e,t)=>{b.value[t]={from:t===0?0:b.value[t-1].to,to:t===0?S.value:b.value[t-1].to+S.value,name:e.name}})},E=()=>{if(!g.value)return;let e=Math.random()*360+360*5;e-=e%S.value,y.value=e;let t=m.config.rollback?Math.random()*m.config.rollback+1:1;g.value.style.setProperty(`--targetDeg`,`-${y.value}deg`),g.value.style.setProperty(`--rollBackDeg`,`${t}`),_.value=!0},D=()=>{if(!g.value)return;v.value=y.value%360,g.value.style.setProperty(`--currentDeg`,`-${v.value}deg`);let e=v.value+S.value/2,t=null;b.value.forEach(n=>{e>=n.from&&e<=n.to&&(t=n.name)}),_.value=!1,h(`finished`,t)},O=e=>{let t=`./../assets/slotImg/img_${e}.jpg`;return new URL(t,import.meta.url).href};return d(()=>m.config,()=>{w()},{deep:!0}),d(()=>m.trigger,()=>{E()}),d(_,e=>{e&&setTimeout(()=>{D()},m.config.duration+200)}),a(()=>{w(),T()}),(e,a)=>(r(),l(`div`,{ref_key:`container`,ref:g,class:n([`gift-container`,x.value,{autoTurn:_.value}])},[(r(!0),l(s,null,f(i.config.gifts,(e,a)=>(r(),l(`div`,{key:a,class:n([`gift`,i.config.style]),style:t(`transform: rotateX(${S.value*a}deg) translateZ(${C.value}px)`)},[o(`img`,{src:O(a),height:i.config.height},null,8,p)],6))),128))],2))}},h=u(m,[[`__scopeId`,`data-v-aeb8529b`]]),g={id:`SlotMachine`},_={class:`body`},v={class:`window`},y={class:`slot__container`},b={__name:`index`,setup(t){e(!1);let c=e(null),u=e(!1),d=e(!1);e(!1);let p=e([]),m=e([]),b=e([{style:`gift-style`,gifts:Array.from({length:15},(e,t)=>({type:`text`,name:t})),duration:4e3,fontSize:150,height:500,width:900}]),x=()=>{u.value=!0,setTimeout(()=>{u.value=!1},500),d.value=!0,c.value=new Date},S=e=>{let t=document.querySelectorAll(`.autoTurn`);m.value.push(e),t.length===1&&(d.value=!1,p.value.push(m.value),m.value=[])};return a(()=>{}),(e,t)=>(r(),l(`div`,g,[t[3]||=o(`div`,{class:`badge`},[o(`span`,null,`SlotMachine`)],-1),o(`div`,_,[o(`div`,v,[o(`div`,y,[(r(!0),l(s,null,f(b.value,(e,t)=>(r(),i(h,{key:t,trigger:c.value,config:e,onFinished:S},null,8,[`trigger`,`config`]))),128))])]),o(`div`,{class:n([`handler`,{active:u.value,disabled:d.value}])},[t[1]||=o(`div`,{class:`stick2`},null,-1),t[2]||=o(`div`,{class:`stick`},null,-1),o(`div`,{class:`ball`,onClick:t[0]||=e=>!d.value&&x()})],2)])]))}};export{b as default};