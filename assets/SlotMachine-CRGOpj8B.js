import{S as e,T as t,a as n,b as r,g as i,i as a,m as o,n as s,o as c,r as l,t as u,v as d,w as f}from"./index-C8a6htQ2.js";var p=[`src`,`height`],m={__name:`Gift`,props:{trigger:{type:Date,default:void 0},config:{type:Object,required:!0}},emits:[`finished`],setup(n,{emit:u}){let m=n,h=u,g=e(null),_=e(!1),v=e(0),y=e(0),b=e([]),x=l(()=>m.config.run3D?`three-dimension`:`flat`),S=l(()=>360/m.config.gifts.length),C=l(()=>m.config.height/2/Math.tan(S.value/2/180*Math.PI)),w=()=>{g.value&&(g.value.style.setProperty(`--rotateY`,`${m.config.rotateY}deg`),g.value.style.setProperty(`--duration`,`${m.config.duration}ms`),g.value.style.setProperty(`--fontSize`,`${m.config.fontSize}px`),g.value.style.setProperty(`--height`,`${m.config.height}px`),g.value.style.setProperty(`--width`,`${m.config.width}px`),g.value.style.setProperty(`--currentDeg`,`-${v.value}deg`))},T=()=>{m.config.gifts.forEach((e,t)=>{b.value[t]={from:t===0?0:b.value[t-1].to,to:t===0?S.value:b.value[t-1].to+S.value,name:e.name}})},E=()=>{if(!g.value)return;let e=Math.random()*360+360*5;e-=e%S.value,y.value=e;let t=m.config.rollback?Math.random()*m.config.rollback+1:1;g.value.style.setProperty(`--targetDeg`,`-${y.value}deg`),g.value.style.setProperty(`--rollBackDeg`,`${t}`),_.value=!0},D=()=>{if(!g.value)return;v.value=y.value%360,g.value.style.setProperty(`--currentDeg`,`-${v.value}deg`);let e=v.value+S.value/2,t=null;b.value.forEach(n=>{e>=n.from&&e<=n.to&&(t=n.name)}),_.value=!1,h(`finished`,t)},O=e=>{let t=`./../assets/slotImg/img_${e}.jpg`;return new URL(t,import.meta.url).href};return r(()=>m.config,()=>{w()},{deep:!0}),r(()=>m.trigger,()=>{E()}),r(_,e=>{e&&setTimeout(()=>{D()},m.config.duration+200)}),o(()=>{w(),T()}),(e,r)=>(i(),c(`div`,{ref_key:`container`,ref:g,class:f([`gift-container`,x.value,{autoTurn:_.value}])},[(i(!0),c(s,null,d(n.config.gifts,(e,r)=>(i(),c(`div`,{key:r,class:f([`gift`,n.config.style]),style:t(`transform: rotateX(${S.value*r}deg) translateZ(${C.value}px)`)},[a(`img`,{src:O(r),height:n.config.height},null,8,p)],6))),128))],2))}},h=u(m,[[`__scopeId`,`data-v-aeb8529b`]]),g={id:`SlotMachine`},_={class:`body`},v={class:`window`},y={class:`slot__container`},b={__name:`index`,setup(t){e(!1);let r=e(null),l=e(!1),u=e(!1);e(!1);let p=e([]),m=e([]),b=e([{style:`gift-style`,gifts:Array.from({length:15},(e,t)=>({type:`text`,name:t})),duration:4e3,fontSize:150,height:500,width:900}]),x=()=>{l.value=!0,setTimeout(()=>{l.value=!1},500),u.value=!0,r.value=new Date},S=e=>{let t=document.querySelectorAll(`.autoTurn`);m.value.push(e),t.length===1&&(u.value=!1,p.value.push(m.value),m.value=[])};return o(()=>{}),(e,t)=>(i(),c(`div`,g,[t[3]||=a(`div`,{class:`badge`},[a(`span`,null,`SlotMachine`)],-1),a(`div`,_,[a(`div`,v,[a(`div`,y,[(i(!0),c(s,null,d(b.value,(e,t)=>(i(),n(h,{key:t,trigger:r.value,config:e,onFinished:S},null,8,[`trigger`,`config`]))),128))])]),a(`div`,{class:f([`handler`,{active:l.value,disabled:u.value}])},[t[1]||=a(`div`,{class:`stick2`},null,-1),t[2]||=a(`div`,{class:`stick`},null,-1),a(`div`,{class:`ball`,onClick:t[0]||=e=>!u.value&&x()})],2)])]))}};export{b as default};